################################################################################
# Proxy points incoming traffic at ambassadors
################################################################################
nginxproxy:
  build: "https://github.com/fogies/docker-nginx.git"
  volumes:
    - "scratch/config/nginxproxy:/config"
    - "scratch/secrets/tractdbssl/tractdb.org.nginx.crt:/etc/ssl/nginx/tractdb.org.nginx.crt"
    - "scratch/secrets/tractdbssl/tractdb.org.key:/etc/ssl/nginx/tractdb.org.key"
    - "scratch/secrets/tractdbssl/tractdb.org.dhparams.pem:/etc/ssl/nginx/tractdb.org.dhparams.pem"
  ports:
    - "80:80"
    - "443:443"
  links:
    - tractdbcouchambassador:tractdbcouch
    - tractdbpyramidambassador:tractdbpyramid
    - webdubambassador:webdub
    - webduboldpapersambassador:webduboldpapers

################################################################################
# tractdbcouch, its ambassador, and its watcher
################################################################################
tractdbcouch:
  # port 5984
  build: "https://github.com/tractdb/docker-tractdb-couch.git"
  volumes:
    - "backup/tractdbcouch/data:/var/lib/couchdb"
    - "backup/tractdbcouch/logs:/var/log/couchdb"
    - "scratch/secrets/tractdbcouch:/secrets"

tractdbcouchambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbcouch_1"

tractdbcouchwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/tractdb/docker-tractdb-couch.git"
    SERVICE: "tractdbcouch"

################################################################################
# tractdbpyramid, its ambassador, and its watcher
################################################################################
tractdbpyramid:
  # port 8080
  build: "https://github.com/tractdb/docker-tractdb-pyramid.git"

tractdbpyramidambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbpyramid_1"

tractdbpyramidwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/tractdb/docker-tractdb-pyramid.git"
    SERVICE: "tractdbpyramid"

################################################################################
# webcse441sp15 and its watcher
################################################################################
webcse441sp15:
  build: "https://github.com/fogies/docker-jekyll-site.git"
  volumes:
    - "scratch/secrets/webcse441sp15/webcse441sp15.yml:/publish.yml"
  environment:
    GIT_REPOSITORY_SITE: "https://github.com/uwcse441/web-cse441-sp15.git"

webcse441sp15watcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/fogies/docker-jekyll-site.git"
    GIT_REPOSITORY_SITE: "https://github.com/uwcse441/web-cse441-sp15.git"
    SERVICE: "webcse441sp15"

################################################################################
# webjayfo and its watcher
################################################################################
webjayfo:
  build: "https://github.com/fogies/docker-jekyll-site.git"
  volumes:
    - "scratch/secrets/webjayfo/webjayfo.yml:/publish.yml"
  environment:
    GIT_REPOSITORY_SITE: "https://github.com/fogies/web-jayfo.git"

webjayfowatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/fogies/docker-jekyll-site.git"
    GIT_REPOSITORY_SITE: "https://github.com/fogies/web-jayfo.git"
    SERVICE: "webjayfo"

################################################################################
# webdub, its ambassador, and its watcher
################################################################################
webdub:
  # port 4000
  build: "https://github.com/fogies/docker-jekyll-site.git"
  environment:
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub.git"

webdubambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_webdub_1"

webdubwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/fogies/docker-jekyll-site.git"
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub.git"
    SERVICE: "webdub"

################################################################################
# webduboldpapers, its ambassador, and its watcher
################################################################################
webduboldpapers:
  # port 4000
  build: "https://github.com/fogies/docker-jekyll-site.git"
  environment:
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub-oldpapers.git"

webduboldpapersambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_webduboldpapers_1"

webduboldpaperswatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/fogies/docker-jekyll-site.git"
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub-oldpapers.git"
    SERVICE: "webduboldpapers"
