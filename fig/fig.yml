################################################################################
# Our proxy, which should only point at ambassadors
################################################################################
nginxproxy:
  build: "https://github.com/fogies/docker-nginx.git"
  volumes:
    - "scratch/config/nginxproxy:/config"
  ports:
    - "80:80"
    - "443:443"
  links:
    - ambassadortractdbcouch
    - ambassadortractdbpyramid
    - ambassadorwebdub

################################################################################
# TractDBCouch and its ambassador
################################################################################
tractdbcouch:
  # port 5984
  build: "https://github.com/tractdb/docker-tractdb-couch.git"
  volumes:
    - "backup/tractdbcouch/data:/var/lib/couchdb"
    - "backup/tractdbcouch/logs:/var/log/couchdb"
    - "scratch/secrets/tractdbcouch:/secrets"

ambassadortractdbcouch:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbcouch_1"

################################################################################
# TractDBPyramid and its ambassador
################################################################################
tractdbpyramid:
  # port 8080
  build: "https://github.com/tractdb/docker-tractdb-pyramid.git"

ambassadortractdbpyramid:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbpyramid_1"

################################################################################
# WebDUB, its ambassador, and its watcher
################################################################################
webdub:
  # port 4000
  build: "https://github.com/fogies/docker-jekyll-site.git"
  environment:
    JEKYLL_GIT_REPOSITORY: "https://github.com/uwdub/web-dub.git"

ambassadorwebdub:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_webdub_1"

watcherwebdub:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY: "https://github.com/uwdub/web-dub.git"
    CONTAINER: "webdub"
