################################################################################
# Our proxy, which should only point at ambassadors
################################################################################
nginxproxy:
  build: "https://github.com/fogies/docker-nginx.git"
  volumes:
    - "scratch/config/nginxproxy:/config"
  ports:
    - "80:80"
    - "443:443"
  links:
    - tractdbcouchambassador:tractdbcouch
    - tractdbpyramidambassador:tractdbpyramid
    - webdubambassador:webdub

################################################################################
# TractDBCouch and its ambassador
################################################################################
tractdbcouch:
  # port 5984
  build: "https://github.com/tractdb/docker-tractdb-couch.git"
  volumes:
    - "backup/tractdbcouch/data:/var/lib/couchdb"
    - "backup/tractdbcouch/logs:/var/log/couchdb"
    - "scratch/secrets/tractdbcouch:/secrets"

tractdbcouchambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbcouch_1"

tractdbcouchwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/tractdb/docker-tractdb-couch.git"
    SERVICE: "tractdbcouch"

################################################################################
# TractDBPyramid and its ambassador
################################################################################
tractdbpyramid:
  # port 8080
  build: "https://github.com/tractdb/docker-tractdb-pyramid.git"

tractdbpyramidambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_tractdbpyramid_1"

tractdbpyramidwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/tractdb/docker-tractdb-pyramid.git"
    SERVICE: "tractdbpyramid"

################################################################################
# WebDUB, its ambassador, and its watcher
################################################################################
webdub:
  # port 4000
  build: "https://github.com/fogies/docker-jekyll-site.git"
  environment:
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub.git"

webdubambassador:
  image: cpuguy83/docker-grand-ambassador
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
  command: "-name fig_webdub_1"

webdubwatcher:
  build: "https://github.com/fogies/docker-watcher.git"
  volumes:
    - "/var/run/docker.sock:/var/run/docker.sock"
    - "fig:/fig"
  environment:
    GIT_REPOSITORY_SERVICE: "https://github.com/fogies/docker-jekyll-site.git"
    GIT_REPOSITORY_SITE: "https://github.com/uwdub/web-dub.git"
    SERVICE: "webdub"
